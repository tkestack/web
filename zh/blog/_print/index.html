<!doctype html><html lang=zh class=no-js><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=generator content="Hugo 0.83.1"><link rel=canonical type=text/html href=/web/zh/blog/><meta name=ROBOTS content="NOINDEX, NOFOLLOW"><link rel="shortcut icon" href=/web/favicons/favicon.ico><link rel=apple-touch-icon href=/web/favicons/apple-touch-icon-180x180.png sizes=180x180><link rel=icon type=image/png href=/web/favicons/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=/web/favicons/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=/web/favicons/android-36x36.png sizes=36x36><link rel=icon type=image/png href=/web/favicons/android-48x48.png sizes=48x48><link rel=icon type=image/png href=/web/favicons/android-72x72.png sizes=72x72><link rel=icon type=image/png href=/web/favicons/android-96x96.png sizes=96x96><link rel=icon type=image/png href=/web/favicons/android-144x144.png sizes=144x144><link rel=icon type=image/png href=/web/favicons/android-192x192.png sizes=192x192><title>TKEStack 博客 | Tkestack</title><meta name=description content="生产级别多集群管理系统"><meta property="og:title" content="TKEStack 博客"><meta property="og:description" content="生产级别多集群管理系统"><meta property="og:type" content="website"><meta property="og:url" content="/web/zh/blog/"><meta property="og:site_name" content="Tkestack"><meta itemprop=name content="TKEStack 博客"><meta itemprop=description content="生产级别多集群管理系统"><meta name=twitter:card content="summary"><meta name=twitter:title content="TKEStack 博客"><meta name=twitter:description content="生产级别多集群管理系统"><link rel=preload href=/web/scss/main.min.f3f5e11928ea652eef8f11ab959efa477bbd1a85923ff5e0245c83fe74bd312a.css as=style><link href=/web/scss/main.min.f3f5e11928ea652eef8f11ab959efa477bbd1a85923ff5e0245c83fe74bd312a.css rel=stylesheet integrity><script src=https://code.jquery.com/jquery-3.5.1.min.js integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin=anonymous></script></head><body class="td-section td-blog"><header><nav class="js-navbar-scroll navbar navbar-expand navbar-dark flex-column flex-md-row td-navbar"><a class=navbar-brand href=/web/zh/><span class=navbar-logo></span><span class="text-uppercase font-weight-bold">Tkestack</span></a><div class="td-navbar-nav-scroll ml-md-auto" id=main_navbar><ul class="navbar-nav mt-2 mt-lg-0"><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/web/zh/docs/><span>Docs</span></a></li><li class="nav-item mr-4 mb-2 mb-lg-0"><a class=nav-link href=/web/zh/blog/><span>Blog</span></a></li><li class="nav-item dropdown d-none d-lg-block"><a class="nav-link dropdown-toggle" href=# id=navbarDropdown role=button data-toggle=dropdown aria-haspopup=true aria-expanded=false>中文 Chinese</a><div class=dropdown-menu aria-labelledby=navbarDropdownMenuLink><a class=dropdown-item href=/web/blog/>English</a></div></li></ul></div><div class="navbar-nav d-none d-lg-block"></div></nav></header><div class="container-fluid td-outer"><div class=td-main><div class="row flex-xl-nowrap"><div class="col-12 col-md-3 col-xl-2 td-sidebar d-print-none"></div><div class="d-none d-xl-block col-xl-2 td-toc d-print-none"></div><main class="col-12 col-md-9 col-xl-8 pl-md-5 pr-md-4" role=main><div class=td-content><div class="pageinfo pageinfo-primary d-print-none"><p>这是本节的多页打印视图。
<a href=# onclick="return print(),!1">点击此处打印</a>.</p><p><a href=/web/zh/blog/>返回本页常规视图</a>.</p></div><h1 class=title>TKEStack 博客</h1><ul><li><a href=#pg-bdcc72ec4f0032b1d49860cf2520f4b3>TKEStack 容器混合云能力介绍（1）：统一基石</a></li><li><a href=#pg-89581b78a6814df37de4a78cba3ec27f>腾讯开源容器云平台 TKEStack 介绍</a></li></ul><div class=content><p>This is the <strong>blog</strong> section.</p></div></div><div class=td-content><h1 id=pg-bdcc72ec4f0032b1d49860cf2520f4b3>TKEStack 容器混合云能力介绍（1）：统一基石</h1><div class="td-byline mb-4"><time datetime=2021-08-02 class=text-muted>2021.08.02</time></div><p><strong>Author</strong>: LeoRyu, HuXiaoLiang</p><p><em>随着云计算及云原生技术在各个领域内的逐步普及，基于 Kubernetes 的混合云相关概念和项目越来越受到人们的关注。以混合云形态部署企业的业务服务，在理论上可以最大化利用现有资源，形成差异互补和成本优化。以云计算及云原生技术作为基础设施的企业大致可以分为两类：一种是已经有存量 IDC 的企业，一种是业务全面使用公有云的企业。从已经有存量 IDC 的企业角度考虑，混合云可以最大化利用现有IDC资源的同时，既可以发挥 IDC 的灵活安全能力，也可以享受到公有云的高性价比优势；从业务全面使用公有云的企业角度考虑，混合云在为企业提供不同云服务商的差异能力的同时，也减少了企业绑定单一云服务商的潜在风险。尽管混合云的愿景是美好的，但走向这愿景的路并非简单。本文将着重介绍 TKEStack 提供混合云能力的道路上，在统一操作系统版本、 Kubernetes 版本、容器运行时和用户交互上遇到的困境与解决方案。</em></p><h2 id=不统一带来的问题>不统一带来的问题</h2><h3 id=安全风险>安全风险</h3><p>在 Linux 和 Kubernetes 受到广泛关注的今天，其安全问题的影响范围也越来越大。例如 2018 年爆出的特斯拉公司计算基础设施被黑客入侵用来挖矿的事件<sup>[1]</sup>，就是因为特斯拉在亚马逊 AWS 上的 Kubernetes 容器集群访问权限没有得到妥善保护，导致存储在S3网络存储桶上的一些敏感技术数据，例如遥测技术，被窃取。</p><p>根据 Palo Alto Networks 公司 Unit 42 团队的研究报告，在 2018 年 1 月至 2019 年 6 月之间，有2万多个基于 Kubernetes 的容器平台被暴露，下图为这些被暴露平台在全球范围内的统计数据<sup>[2]</sup>：</p><img alt=被暴露的平台统计 width=100% src=exposed-k8s.png><p>该报告中还统计了各云服务提供商平台上发现的漏洞：亚马逊 AWS 平台上被发现超过 2900 万个漏洞，谷歌云发现的漏洞数量接近 400 万，微软 Azure 发现了 170 万左右漏洞。</p><p>这些漏洞分布在各种操作系统版本、Kubernetes 发行版本、容器运行时乃至用户交互的前端相关代码中。这些关键要素的不统一在客观上为这些安全漏洞提供了温床。</p><h3 id=运维成本>运维成本</h3><p>不统一也会使得用户的运维成本变得很高。例如当前 TKEStack 在混合云场景主推的网络方案 Cilium，其很多特性都要求在特定的内核版本以上才支持开启，下图是 Cilium 不同特性对内核版本要求的统计<sup>[3]</sup>：</p><img alt=Cilium特性内核版本要求 width=100% src=required-kernel-version.png><p>而 Kubernetes 版本尽管声明 patch 版本上下兼容，但实际上在各版本间 API 资源对象的转换方面可能存在兼容问题。例如 TKEStack 在升级 Kubernetes API 版本时就发现 <code>url.Values</code> 隐式自动转换为 Kubernetes 对象已经被废弃<sup>[4]</sup>，导致很多接口无法正常使用。</p><p>随着业务的运行时间拉长和不断迭代，因为操作系统、Kubernetes、容器运行时和 UI 的不统一造成的运维成本，也会随着时间的推移越堆越高。</p><h2 id=tkestack-社区为统一操作系统和-kubernetes-版本做出的努力>TKEStack 社区为统一操作系统和 Kubernetes 版本做出的努力</h2><h3 id=推荐使用-tencentos-server>推荐使用 TencentOS Server</h3><p>TencentOS Server 又名 Tencent Linux，简称 Tlinux 是腾讯针对云场景研发的 Linux 操作系统，提供了专门的功能特性和性能优化，为云服务器实例中的应用程序提供高性能，且更加安全可靠的运行环境<sup>[5]</sup>。</p><img alt=TencentOS width=100% src=tencentos-logo.png><p>作为一个Linux发行版，Tlinux拥有以下优势：</p><ol><li><p>内核定制，基于内核社区长期支持的4.14.105版本定制而成，增加适用于云场景的新特性、改进内核性能并修复重大缺陷。</p></li><li><p>容器支持，针对容器场景进行优化，提供了隔离增强和性能优化特性：meminfo、vmstat、cpuinfo、stat、loadavg, uptime, diskstats。</p></li><li><p>性能优化，计算、存储和网络子系统均经过优化，包括：优化 xfs 内存分配，解决 xfs kmem_alloc 分配失败告警优化网络收包大内存分配问题，解决 UDP 包量大时，占据过多内存问题限制系统 page cache 占用内存比例，从而避免内存不足影响业务的性能或者 OOM。</p></li><li><p>缺陷支持，提供操作系统崩溃后的 kdump 内核转储能力提供内核的热补丁升级能力。</p></li><li><p>安全更新，会定期进行更新，增强安全性及功能。</p></li><li><p>其他特性，离线调度算法(BT)、进程防gdb、ARM64热补丁、pagecache limit等。</p></li></ol><p>在混合云场景下 TKEStack 推荐使用 TencentOS Server 作为底层的操作系统，安全高效并提供了强大的云原生能力，关于 TencentOS Server 可以到项目网站 <a href=https://github.com/Tencent/TencentOS-kernel>https://github.com/Tencent/TencentOS-kernel</a> 以了解更多内容。</p><h3 id=引入-tke-发行版到-tkestack>引入 TKE 发行版到 TKEStack</h3><p>长久以来，TKEStack 只提供了原生 Kubernetes 给用户使用，这使得 TKEStack 所能提供给用户的能力常常受到原生 Kubernetes 的现有能力的限制。为了打破这一现状，TKEStack 在前不久发布的 1.7 版本引入了由腾讯云 TKE 发布的 Kubernetes 发行版本，TKE 发行版（TKE Kubernetes Distro）。TKE 发行版在保证兼容性的基础上，对 K8s 进行了扩展，并且与腾讯云 TKE 服务保持版本一致。用户可以在自己的 IDC 或者混合云上部署 TKE 发行版，使用已有企业用户大规模验证的可靠安全的 Kubernetes 服务<sup>[6]</sup>。</p><img alt=TKE发行版 width=100% src=tke-distro.png><p>相比原生的 Kubernetes 版本，TKE 发行版优势有下面几项：</p><ol><li><p>大规模生产集群验证，TKE 发行版提供与腾讯云 TKE 相同的可安装版本和开源代码，功能和稳定性经过大量企业用户、公有云及自研云锤炼。用户可以使用提供的源代码和编译工具进行构建和部署。</p></li><li><p>无缝集成公有云 TKE，TKE 发行版可支持用户在自建或者托管机房，物理机或者虚机上，运行与腾讯云 TKE 完全一致的 K8s 服务。并且可以无缝与腾讯云 TKE 集成，组建混合云集群。</p></li><li><p>更长支持周期，TKE 发行版的支持周期比社区版更长。在社区版停止支持后，TKE 发行版将继续得到支持，包括重要问题以及安全漏洞的修复。</p></li><li><p>更多实用能力增强，TKE 发行版结合腾讯自身业务特点和经验，针对部分场景（弹性扩容、离在线混部、资源隔离等）实现了能力增强。并且 TKE 发行版紧跟社区趋势，主导或深度参与社区 KEP 设计与实现。对于有实用价值 KEP 会先于社区支持，让用户提前享受到云原生技术进步。</p></li></ol><p>关于 TKE 发行版的更多信息可以访问 <a href=https://github.com/tkestack/tke-k8s-distro>https://github.com/tkestack/tke-k8s-distro</a> 以进一步了解。</p><p>在 1.7 版本中 TKEStack 支持 TKE 发行版本和原生两种 Kubernetes 发行版本，由于 TKE 发行版完全兼容原生 Kubernetes 发行版本，在后续的迭代中 TKEStack 将朝着只携带 TKE 发行版的方向逐步前进。</p><h3 id=使用-containerd-作为容器运行时>使用 Containerd 作为容器运行时</h3><p>2020 年年末，Kubernetes社区宣布预计最早将在2021年晚些时候发布的 1.23 版本中废弃dockershim<sup>[7]</sup>，这意味着未来的 Kubernetes 将不再支持以 Docker 作为容器运行时。</p><p>TKEStack 社区经过研讨调研后，决定使用和腾讯公有云 TKE 一致的 Containerd 作为未来替代 Docker 的容器运行时。Containerd 是除 Docker 外当下最为成熟稳定，并被广泛接受的容器运行时，下图是 2021 年年初关于容器运行时使用率相关的调查统计<sup>[8]</sup>：</p><img alt=运行时使用率 width=100% src=container-runtimes.png><p>Containerd 的架构是 client-server 架构，支持 runc、Kata Container 等多种底层运行时，同时又有很高的扩展性，下图为 Containerd 的整体架构图<sup>[9]</sup>：</p><img alt=containerd整体架构 width=100% src=containerd-architecture.png><p>作为过渡时期，如果用户选择的 Kubernetes 版本依旧支持 dockershim，TKEStack 将允许用户在创建集群时决定选择 Docker 还是 Containerd 作为容器运行时，并提供文档，帮助用户将存量集群的 runtime 从 Docker 迁移到 Containerd。未来，TKEStack会移除掉 Docker 的依赖，全面兼容社区的 CRI 标准模型，并将 Containerd 作为默认的 runtime 与公有云 TKE 保持统一。</p><h3 id=风格统一的用户交互>风格统一的用户交互</h3><p>统一的交互风格可以大大减少用户的学习成本和心智负担。TKEStack 与腾讯公有云 TKE 产品采用了相同的交互风格，用户只需要适应了其中一个的交互习惯，就可以几乎零学习成本的操作使用另外一款产品。下图展示了 TKEStack 和腾讯公有云 TKE 产品的用户前端交互页面：</p><img alt=containerd整体架构 width=100% src=tkestack-and-tke.png><p>TKEStack 和腾讯公有云 TKE 产品上有着很多相同的概念，针对这些概念的视图展示逻辑也是一致的。在混合云场景下，这种一致性将产生积极的化学反应，对用户非常友好，并减轻了维护上的成本。</p><p>交互的统一不仅仅对用户有很多好处，对后续 TKEStack 的产品设计，后台架构搭建及能力实现上都有着积极的作用，而这种积极作用会为 TKEStack 加速布局混合云领域提供有力的支持。</p><h2 id=总结>总结</h2><p>正所谓工欲善其事，必先利其器，只有统一巩固一个强大稳定的平台基石，TKEStack 才会在提供混合云能力的道路上行驶的更加平稳。后续我们会在该系列中介绍更多关于 TKEStack 的混合云能力，敬请大家期待。</p><p>最后欢迎大家到 TKEStack 的项目仓库 <a href=https://github.com/tkestack/tke>https://github.com/tkestack/tke</a> 提出建议贡献力量，大家的支持将会令 TKEStack 项目变得更好！</p><h2 id=参考资料>参考资料</h2><p>[1] Lessons from the Cryptojacking Attack at Tesla [https://redlock.io/blog/cryptojacking-tesla]</p><p>[2] Cloudy with a Chance of Entropy [https://www.paloaltonetworks.com/resources/research/unit42-cloud-with-a-chance-of-entropy]</p><p>[3] Required Kernel Versions for Advanced Features [https://docs.cilium.io/en/v1.10/operations/system_requirements/#required-kernel-versions-for-advanced-features]</p><p>[4] Can no longer call DecodeParameters with url.Values in 1.19.0 client-go [https://github.com/kubernetes/kubernetes/issues/94688]</p><p>[5] 腾讯TencentOS 十年云原生的迭代演进之路 [https://mp.weixin.qq.com/s/Cbck85WmivAW0mtMYdeEIw]</p><p>[6] 腾讯云云原生混合云-TKE发行版 [https://mp.weixin.qq.com/s/d7ubPXwtTw8JsFIHp-JXEg]</p><p>[7] Dockershim Deprecation FAQ [https://kubernetes.io/blog/2020/12/02/dockershim-faq/]</p><p>[8] Sysdig 2021 container security and usage report: Shifting left is not enough [https://sysdig.com/blog/sysdig-2021-container-security-usage-report/]</p><p>[9] Introduction and Deep Dive Into Containerd [https://static.sched.com/hosted_files/kccnceu2021/d3/containerd-KubeConEU2021.pdf]</p></div><div class=td-content style=page-break-before:always><h1 id=pg-89581b78a6814df37de4a78cba3ec27f>腾讯开源容器云平台 TKEStack 介绍</h1><div class="td-byline mb-4"><time datetime=2021-06-09 class=text-muted>2021.06.09</time></div><p><strong>Author</strong>: Yingzhe Ru (汝英哲)</p><p><em>2019年11月在腾讯 Techo 开发者大会上，TKEStack 正式发布并宣布开源， 同一时间凝结着腾讯多年来容器技术积累的代码也通过 push 命令上传到 github， 从那一刻起我们开启了一段面向开源，充满机遇与挑战，驶向未来云世界的伟大航程。 时间回到今天，TKEStack 自开源后已经过去了几个月，迭代了多个版本，当前仍在以较快的速度提交修改，发布更新。 随着开发进度的推进，产品的功能逐渐增强，用户体验愈发的完善，整个产品和技术栈的轮廓也愈加的清晰， 因此有必要在这里系统介绍一下 TKEStack 容器云平台，明确我们的目标，展示平台的特性以及为您提供的价值，希望您阅读完这篇文章后， 能够对 TKEStack 产生兴趣，了解到 TKEStack 的能力，并能够考虑使用或集成 TKEStack 助力您的业务或商业产品落地。</em></p><h2 id=简介>简介</h2><p>近年来在云计算领域，容器技术领域不断创新，围绕容器以及容器相关技术构建出云原生的生态和技术标准。 基于 Kubernetes 的容器平台，为容器化的应用提供资源调度、部署运行、服务发现和弹性伸缩等整一套功能， 逐步成为客户软件基础设施的不二之选。</p><p>腾讯在云计算领域深耕多年，尤其在容器技术领域，自2009年开发容器计算平台 T-Borg 开始，2012年开发内部的离线在线混合部署的容器平台 Torca，2013、2014年 Docker 和 Kubernetes 出现后，腾讯迅速切换自研方案到开源方案，对外推出商用公有云版本服务TKE和私有云版本 GaiaStack。2019年，公有云和私有云版本合并为统一架构和方案 TKE，并推出了社区发行版 TKEStack。</p><p>TKEStack是腾讯内部几大团队合力打造的开源版本，总结了多年来腾讯在云原生领域的经验和技术积累，吸收了 Gaia 平台、TKE公有云以及腾讯内部众多容器产品的优点，全新打造的面向私有云业务场景的开源容器平台。TKEStack 以高起点起步，甩掉大量历史遗留包袱，从架构上重新设计，并且结合业内生态最新的更新和特性，使得TKEStack轻装上阵，用户开箱即用最新的云原生能力。</p><p>TKEStack 名称中包含 Stack，也表明 TKEStack 有别于其他容器产品，它将打造的是一整套技术栈，以 TKE 容器平台为核心，面向网络，存储，应用，服务等各个领域，扩展平台在底层资源管控和上层业务服务上的能力边界，所有这些能力都将在 TKEStack 下开源，社区用户、合作伙伴等都可以参与进来贡献和分享。</p><h2 id=愿景与目标>愿景与目标</h2><p>未来云计算基础设施一定处于多维异构的状态，未来客户也会处于多维异构的业务场景，包括硬件异构、基础架构异构和业务平台异构。</p><ul><li>硬件异构 - 随着国产化在国内的发展，将来客户的服务器架构将会是 x86 和 arm64 混杂在一起；随着AI计算发展，Intel 等厂商也加入到 GPU 的竞争中，再加上 ARM 平台的 GPU 和 FPGA 等硬件，计算领域的硬件将更加碎片化。</li><li>基础架构异构 - 未来的数字化计算服务中心，尤其在国内，将更多会采用私有化(或专有云)和公有云混合部署的模型支持业务发展。</li><li>业务平台异构 - 传统业务在无法全部迁移下的情况，长期会和微服务、Service Mesh 、Serverless等技术组成一个异构的业务大中台，同时还要支撑使用 Spark、Hadoop、TensorFlow、PyTorch 等计算平台运行。</li></ul><p>我们的愿景是为内部业务和外部商业客户提供离线计算业务和在线服务业务混合部署的一站式通用基础架构平台。 基于此愿景，TKEStack 将继承腾讯内部容器技术优势，为用户、为合作伙伴、为生态创造价值，生态共建，产业共创。</p><ul><li>面向用户 - 为用户提供稳定高效可扩展的容器服务产品，提供便捷的安装部署、简洁的管控和资源管理，以及完善的运维工具支持，满足业务上云需求。</li><li>面向合作伙伴 - 为下游产品提供调度能力强大、功能丰富、性能稳定的容器底座，使用户能基于 TKEStack 便捷打造易部署、易维护、易扩展的产品和服务，在互联网、传统行业与政企等领域提供有针对性的行业解决方案。</li><li>面向生态 - 围绕容器生态的各种能力，统一应用服务的定义，发布、配置、升级及运维整个生命周期管理，整合中间件、运行时、存储、网络能力，逐步建立起一个基于云原生的容器平台标准。</li></ul><h2 id=整体架构>整体架构</h2><p>TKEStack整体架构上采用 Kubernetes on Kubernetes 的设计理念，充分满足平台服务的高可用性和扩展性。</p><img alt=TKEStack整体架构 width=100% src="tkestack_ infrastructure.png"><ul><li>Global: 集群负责运行整个 TKEStack 平台自身所需组件；</li><li>Cluster: 业务集群是由 TKEStack 控制台统一管理，负责运行业务；</li><li>Installer: 负载安装 Global 集群和管控组件；</li><li>Auth: 权限认证组件，提供用户认证、授权相关功能；</li><li>Gateway: 网关组件，并运行控制台的 Web 界面服务；</li><li>Platform: 平台管理组件，提供包含集群管理等功能的平台服务；</li><li>Business: 业务管理组件，提供业务管理相关功能的后台服务；</li><li>Monitor: 监控服务组件，提供监控采集、上报、告警相关服务；</li><li>Notify: 通知功能组件，提供消息通知相关的功能；</li><li>Registry: 镜像服务组件，提供平台镜像仓库和 charts 仓库服务；</li><li>Galaxy: 网络插件，为集群提供多种网络模式服务；</li><li>Logagent: 日志管理组件，为平台提供日志管理相关服务；</li><li>Audit: 设计组件，提供审计服务功能；</li></ul><p>Global 集群提供容器云平台的支撑环境和运行自身所需的各种组件，包括业务管理组件、平台管理组件、权限认证组件、监控和告警组件、registry 镜像仓库组件以及 gateway 前端页面网关组件等等。各个组件以 workload 的形式灵活部署在 global 集群中，各组件多副本高可用方式部署，单个组件异常或者主机节点掉线等故障不会影响global集群的正常运行，TKEStack仍可提供的管理功能，用户正常的业务访问不受影响。</p><p>在扩展性方面，根据不同场景灵活配置集群，例如为承载大流量高可靠性的在线业务，有必要提高 global 集群的规格配置，使其能够管理大规模海量的业务集群及应用资源；如果面向个人开发者或中小型业务，甚至可以简化为仅数个节点组成的 global 集群，并通过该集群承载业务。</p><h2 id=能力特性>能力特性</h2><p>通过集成和使用 TKEStack，不仅支持 K8S 原生的资源调度、部署运行、服务发现和弹性伸缩等整一套功能，TKEStack 还支持多种特性，方便用户接入和使用，通过灵活的扩展功能实现自身服务的增值。</p><h3 id=原生支持>原生支持</h3><p>TKEStack是一款专注于 Kubernetes 技术栈的，集易用性与扩展性于一身的 K8S 发行版，符合Kubernetes接口标准，产品底层完全兼容标准 Kubernetes。因此，基于 Kubernetes 生态的应用和服务都可以无缝迁移到TKEStack上来，有标准K8S运维管理经验的用户可以平滑的切换到 TKEStack 平台。</p><p>TKEStack 跟随最新 k8s 版本，支持所有可用的功能和安全补丁，通过灵活的集群管理功能，方便的对集群进行更新升级操作，帮助用户体验和使用最新的生态技术。作为云原生的基础设施平台，任何符合云原生规范和标准的应用或项目，都可以构建和运行在 TKEStack 中。</p><h3 id=简单易用>简单易用</h3><p>提供和腾讯公有云版一致的 UI，界面简洁友好，支持配置各种 K8S 资源，方便用户顺利的创建和管理容器应用，降低了容器平台的学习和操作成本。TKEStack 还有着完善的镜像仓库和应用商店功能，内部包含腾讯优秀的开源容器应用模板，方便用户一键部署高质量稳定的应用服务。</p><h3 id=多集群管理>多集群管理</h3><p>支持新建独立集群或纳管不同基础设施上的已有 Kubernetes 集群，通过页面或命令行集中管理多个集群，实现了混合云场景下的多集群统一管理能力。只需提供需要管理集群的 api 地址，token 和 ca 证书，TKEStack 就可以纳管该集群。纳管操作不会污染导入的集群，被纳管集群不会增加额外的负载或配置。统一一致的用户权限及业务管理等功能帮助用户在集群间灵活切换，方便的部署和管理多集群应用。</p><img alt=多集群管理 width=100% src=mutil_cluster_management.png><p>更多信息请参考<a href=https://tkestack.github.io/docs/user-guide/platform-console/cluster-mgmt.html>集群管理</a></p><h3 id=多租户管理>多租户管理</h3><p>支持多租户管理和租户间隔离，不仅仅局限于账号，而是包括集群、命名空间、业务、镜像仓库等等，满足大中型规模企业管理的需求。并且在租户层次之下，拥有业务的概念，业务可以横跨集群，为用户提供统一的配额管理、命名空间、业务配额以及镜像仓库和应用商店等管理能力，方便用户在多集群场景下编排业务应用。</p><img alt=多租户管理 width=100% src=mutil_tenant_management.png><p>TKEStack提供统一和开放的认证授权管理，通过扩充 kubernetes 的 authz 和 authn 的 webhook，实现所有集群无需单独配置 RBAC，为上层提供统一的可跨集群的资源授权。TKEStack自身的认证和授权体系是完整的 K8S Style API 以及 oidc 认证协议支持，可以很容易的由第三方集成商或开发者集成在自身的产品中，实现和 TKEStack 捆绑服务。企业级用户可以方便的将已有的账户体系或组织架构映射到 TKEStack 平台中，从而节省容器平台对接的工作量，专注于自身高价值业务的开发。</p><p>更多信息请参考<a href=https://tkestack.github.io/docs/user-guide/platform-console/access-mgmt/>访问管理</a></p><h3 id=运维友好的管理平台>运维友好的管理平台</h3><p>TKEStack 致力于打造一个运维友好的管理平台，帮助运维人员从繁杂的劳动中解放出来。TKEStack 提供完整详细的监控及日志服务，粒度精细到对集群下每一个容器每一条日志都有监控和记录。并且提供智能化的安装工具、巡检工具，帮助运维人员对整个平台全程进行管理，提前发现风险点，提高系统的可靠性。</p><h4 id=快捷安装>快捷安装</h4><p>TKEStack 使用 tke-installer 安装工具进行安装，通过界面化的方式引导用户一键部署 TKEStack 容器平台。tke-installer 安装工具能够检查基本的环境信息，自动适配 x86 或 arm 版本安装驱动和镜像。离线的安装方式更免去用户拉取镜像的烦恼，极大的提高了容器平台部署的效率。</p><img alt=安装流程 width=100% src=install_process.png><p>tke-installer 自动等待和检查每一步骤安装完成，如果中间过程出错会自动在日志界面提示相应的信息，并支持根据用户需要，选择全新安装或从失败步骤继续安装。更支持以 hook 方式自定义安装流程，用户可以在安装开始前、集群 ready 后以及安装结束后三个 hook 点添加自己的脚本或命令，实现平台安装的可定制化。</p><p>更多安装信息请见：<a href=https://github.com/tkestack/tke/tree/master/docs/guide/zh-CN/installation>TKEStack安装说明</a></p><h4 id=监控系统>监控系统</h4><p>免去部署和配置 prometheus 的复杂操作，TKEStack 提供高可用性和可扩展性的细粒度监控系统，实时监控 CPU，GPU，内存，显存，网络带宽，磁盘io等多种指标并自动绘制趋势曲线，帮助运维人员全维度的掌握平台运行状态。</p><img alt=监控系统 width=100% src=monitor.png><p>TKEStack通过prometheus组件监控集群状态，prometheus 组件通过 addon 扩展组件自动完成安装和配置，使用 influxdb，elasticsearch 等存储监控数据。监控数据和指标融入到平台界面中以风格统一图表的风格展示，支持以不同时间，粒度等条件，查询集群，节点，业务，workload以及容器等多个层级的监控数据，全维度的掌握平台运行状态。</p><p>同时针对在可用性和可扩展性方面，支持使用 thanos 架构提供可靠的细粒度监控和警报服务，构建具有高可用性和可扩展性的细粒度监控能力。</p><p>详情请见<a href=https://mp.weixin.qq.com/s/Kn4RACzihWGoajV1Q0G_cA>thanos架构介绍</a></p><h4 id=日志服务>日志服务</h4><p>提供的集群内日志采集功能，支持将集群内服务或集群节点特定路径文件的日志发送至 Kafka、Elasticsearch等消费端，支持采集容器标准输出日志，容器内文件日志以及主机内文件日志。更提供事件持久化、审计等功能，实时记录集群事件及操作日志记录，帮助运维人员存储和分析集群内部资源生命周期、资源调度、异常告警等情况。</p><img alt=日志服务 width=100% src=log.png><p>需要为每个集群手动开启日志采集功能。日志采集功能开启后，log-collector 会在集群内以 DaemonSet 的形式运行，并根据用户通过日志采集规则配置的采集源和消费端，从采集源进行日志采集，将日志内容发送到消费端。</p><ul><li>采集容器标准输出日志 - 采集集群内指定容器的标准输出日志，采集到的日志信息将会以 JSON 格式输出到用户指定的消费端，并会自动附加相关的 Kubernetes metadata， 包括容器所属 pod 的 label 和 annotation 等信息。</li><li>采集容器内文件日志 - 采集集群内指定 pod 内文件的日志，用户可以根据自己的需求，灵活的配置所需的容器和路径，采集到的日志信息将会以 JSON 格式输出到用户指定的消费端， 并会附加相关的 Kubernetes metadata，包括容器所属 pod 的 label 和 annotation 等信息。</li><li>采集主机内文件日志 - 采集集群内所有节点的指定主机路径的日志，log-collector 会采集集群内所有节点上满足指定路径规则的文件日志，以 JSON 格式输出到用户指定的输出端， 并会附加用户指定的 metadata，包括日志来源文件的路径和用户自定义的 metadata。</li></ul><p>更多日志信息请参考<a href=https://tkestack.github.io/docs/user-guide/platform-console/operation-mgmt/log-collect.html>日志管理</a></p><h4 id=平台巡检>平台巡检</h4><p>巡检工具 kube-javis，通过 plugin 插件的方式灵活配置和扩展，多维度的检查 TKEStack 平台下集群的健康状况，支持集成到 TKEStack 平台中，定期运行并输出诊断结果和修复建议。</p><p>更多详细信息请关注<a href=https://github.com/tkestack/kube-jarvis>kube-javis</a></p><h3 id=扩展组件支持和管理>扩展组件支持和管理</h3><p>Tkestack 的特色功能，以扩展组件的方式来订制集群的能力，扩展集群的功能。TKEStack 已支持多种扩展组件，包含：</p><ul><li>GPUManager - GPU Manager 提供一个 All-in-One 的 GPU 管理器, 基于K8S Device Plugin插件系统实现, 提供了 GPU 虚拟化、拓扑分配、GPU 共享、GPU 指标查询、GPU 容器 pre-check 等功能, 支持用户在 K8S 集群中高效的使用 GPU 设备。</li><li>TApp - Tapp 是结合腾讯十多年海量运营经验，全新设计出的一种 workload，以 CRD 的形式实现。 Tapp可运行有状态、无状态应用，弥补了 StatefulSet 无法批量更新容器的不足，使用方式兼容传统运维习惯，更好的支持传统的有状态应用，能够实现灰度升级和多版本的发布管理。</li><li>CronHPA - 使用 crontab 模式定期自动扩容工作负载，周期性地在给定的调度时间对工作负载进行扩缩容。</li><li>LBCF - 一款通用负载均衡控制面框架，对K8S内部晦涩的运行机制进行了封装并以 Webhook 的形式对外暴露，并提供强大的扩展能力以满足业务方在使用负载均衡时的个性化需求。</li><li>CSIOperator - 负责 CSI 相关组件的部署与维护，帮助用户在集群中使用存储。</li><li>IPAM - 通过 IPAM 扩展组件安装，扩展了 K8S 调度插件，实现 Float IP 的配置和管理，满足复杂应用容器化的特殊需求。</li></ul><p>更多详情请参考<a href=https://tkestack.github.io/docs/key-features/>扩展组件</a></p><h2 id=总结>总结</h2><p>随着2020年3月国家发改委进一步明确了包括以云计算等为代表的新技术基础设施纳入“新基建”的范围，国内云计算市场将迎来一波建设的热潮。尤其在私有云领域，传统行业企业基本开始了业务的云迁移，但其应用系统的弹性、自动化运维管理能力以及 Devops 和持续交付的能力仍在不断的探索和尝试，迫切的需要一套成熟的产品平台和生态体系，帮助企业完成云原生转型。</p><p>开源TKEStack的推出，将推动企业业务向云原生的转型，提供完善的容器产品功能，打造运维友好的管理平台，减少用户繁复的劳动，提高工作效率。完善的API和租户管理能力，方便用户将已有的账户体系或组织架构映射到TKEStack平台中，节省平台业务对接的工作量。并且良好的扩展能力使得用户能够基于 TKEStack 适配本地基础设施，扩展业务所需的各种能力。</p><p>TKEStack 已在腾讯内部大量使用，总结积累了大量经验和技术，持续进行迭代开发，不断完善功能特性，并且第一时间将成果贡献给社区，帮助用户紧跟云原生潮流，享用最新技术能力，同时免除了被技术绑定的风险。我们希望通过 TKEStack 的稳定高效和灵活扩展的平台能力，帮助您构建以 TKEStack 为底座的，适配各种硬件架构和基础环境的，面向 AI、大数据、中间件以及微服务等等多种场景的服务，在互联网、传统行业与政企等领域，联合合作伙伴提供有针对性的行业解决方案。TKEStack 仍在不断的成长中，后续我们还会开发更多的功能，输出更多腾讯内部优秀的产品和能力。</p><p>最后，感谢您的时间，希望你在读完文章后，能够了解到 TKEStack 容器云平台，希望 TKEStack 能够成为您的选择， 我们愿与您一道前行，创造价值，加速创新，共建云生态，一起迈向未来云世界。</p></div></main></div></div><footer class="bg-dark py-5 row d-print-none"><div class="container-fluid mx-sm-5"><div class=row><div class="col-6 col-sm-4 text-xs-center order-sm-2"></div><div class="col-6 col-sm-4 text-right text-xs-center order-sm-3"><ul class="list-inline mb-0"><li class="list-inline-item mx-2 h3" data-toggle=tooltip data-placement=top title=GitHub aria-label=GitHub><a class=text-white target=_blank rel=noopener href=https://github.com/tkestack/tke aria-label=GitHub><i class="fab fa-github"></i></a></li></ul></div><div class="col-12 col-sm-4 text-center py-2 order-sm-2"><small class=text-white>&copy; 2021 The TKEStack Authors All Rights Reserved</small></div></div></div></footer></div><script src=https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js integrity=sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN crossorigin=anonymous></script><script src=https://cdn.jsdelivr.net/npm/bootstrap@4.6.0/dist/js/bootstrap.min.js integrity=sha384-+YQ4JLhjyBLPDQt//I+STsc9iw4uQqACwlvpslubQzn4u2UU2UFM80nGisd026JF crossorigin=anonymous></script><script src=/web/js/main.min.1911ee3ae98d7d6df3807cd00d8e31ae7d1c08ee0f0bb587529b0483da4e5464.js integrity="sha256-GRHuOumNfW3zgHzQDY4xrn0cCO4PC7WHUpsEg9pOVGQ=" crossorigin=anonymous></script></body></html>